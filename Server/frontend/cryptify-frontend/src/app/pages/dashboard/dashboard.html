<div class="dashboard-container">

  <!-- HEADER -->
  <header class="header">
    <button class="menu-toggle" (click)="toggleVaultsPanel()" title="Toggle Vaults">
      <i class="fa-solid fa-bars">â˜°</i>
    </button>
    
    <div class="logo">ğŸ” Cryptify</div>

    <div class="user-section">
      <div class="user-icon" (click)="toggleUserMenu()">
        <i class="fa-solid fa-user">ğŸ‘¤</i>
      </div>

      <div class="user-menu" [class.open]="userMenuOpen">
        <p (click)="goToAccount()">
          <i class="fa-regular fa-user"></i> My Account
        </p>
        <p (click)="logout()">
          <i class="fa-solid fa-sign-out-alt"></i> Logout
        </p>
      </div>
    </div>
  </header>

  <!-- MAIN LAYOUT -->
  <div class="layout">

    <!-- LEFT PANEL - VAULTS -->
    <aside class="vaults-panel" [class.show]="vaultsPanelOpen">
      <h3 class="panel-title">ğŸ“ Vaults</h3>

      <div class="vault-list">
        <button 
          *ngFor="let v of vaults" 
          class="vault-item" 
          [class.active]="activeVault?._id === v._id" 
          (click)="selectVault(v); vaultsPanelOpen = false">
          {{ v.name }}
        </button>

        <button class="add-vault-btn">+ New Vault</button>
      </div>
    </aside>

    <!-- CENTER PANEL - PASSWORDS -->
    <main class="center-panel">

      <div class="passwords-header">
        <button class="vault-details-btn" routerLink="/vault-details">Vault Details</button>
        <input class="search-input"  placeholder="ğŸ” Search passwords..."  [(ngModel)]="searchQuery"  (input)="filterPasswords()"/>
        <button class="add-pass-btn" (click)="addPasskey()">+ Add Password</button>
        <button class="export-pass-btn" (click)="exportPasskeys()" [disabled]="exporting" >Export Passwords</button>
      </div>

      <!-- Add Passkey Modal -->
      <app-add-passkey-modal
        [isOpen]="addPasskeyModalOpen"
        [activeVault]="activeVault"
        (close)="closeAddPasskeyModal()"
        (saved)="onPasskeySaved($event)"
      ></app-add-passkey-modal>

      <div class="password-box">

        <!-- TABLE HEADER -->
        <div class="password-table-header">
          <div class="table-col-name">Name</div>
          <div class="table-col-category">Category</div>
          <div class="table-col-username">Username</div>
          <div class="table-col-password">Password</div>
          <div class="table-col-actions">Actions</div>
        </div>

        <!-- PASSWORD ITEMS AS TABLE ROWS -->
        <div 
          class="password-row"  
          *ngFor="let p of filteredPasskeys">

          <div class="table-col-name">{{ p.name }}</div>
          <div class="table-col-category">{{ p.categoryId?.name || '-' }}</div>
          <div class="table-col-username">{{ p.username }}</div>
          <div class="table-col-password">
            <div class="password-value">{{ getDisplayPassword(p._id, p.password) }}</div>
            <button *ngIf="visiblePasswords[p._id]" class="copy-overlay" (click)="copyPassword(p._id, p.password)" [title]="copiedPasswords[p._id] ? 'Copied' : 'Copy password'">
              {{ copiedPasswords[p._id] ? 'âœ“' : 'ğŸ“‹' }}
            </button>
          </div>

          <div class="table-col-actions">
             <button class="action-btn" (click)="togglePasswordVisibility(p._id, p)" title="Show/Hide Password">
                 <i class="fa-regular fa-eye">{{ visiblePasswords[p._id] ? 'ğŸ‘ï¸â€ğŸ—¨ï¸' : 'ğŸ‘ï¸'}}</i>
            </button>
            <button class="action-btn edit" (click)="editPasskey(p._id)" title="Edit">
              <i class="fa-regular fa-pen-to-square">âœï¸</i>
            </button>
            <button class="action-btn delete"  (click)="deletePasskey(p._id)" title="Delete">
              <i class="fa-regular fa-trash-can">ğŸ—‘ï¸</i>
            </button>
          </div>
        </div>

        <!-- EMPTY STATE -->
        <div *ngIf="filteredPasskeys.length === 0" style="text-align: center; padding: 2rem; color: #999;">
          <p style="font-size: 14px;">No passwords found</p>
        </div>

      </div>
    </main>

  </div>
</div>
